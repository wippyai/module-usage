version: "1.0"
namespace: wippy.usage

entries:
  # Requirements
  - name: __requirement-target_db
    kind: ns.requirement
    meta:
      description: "Application database ID for usage tracking"
    targets:
      - entry: target_db
        path: ".default"

  # Dependencies
  - name: __dependency.wippy.test
    kind: "ns.dependency"
    meta:
      description: "Testing component"
    component: "wippy/test"
    version: ">=v0.0.1"

  - name: __dependency.wippy.migration
    kind: "ns.dependency"
    meta:
      description: "Migration component"
    component: "wippy/migration"
    version: ">=v0.0.7"

  # wippy.usage:envs
  - name: envs
    kind: env.storage.os
    meta:
      type: envstorage
      comment: OS storage for environment variables

  # wippy.usage:target_db
  - name: target_db
    kind: env.variable
    meta:
      type: config_key
      comment: Database resource identifier
    storage: wippy.usage:envs

  # wippy.usage:token_usage_repo
  - name: token_usage_repo
    kind: library.lua
    meta:
      comment: Repository for managing token usage data
      tags:
        - tokens
        - usage
      description: Track and analyze LLM token consumption
    source: file://token_usage_repo.lua
    modules:
      - sql
      - json
      - uuid
      - time
      - env

  # wippy.usage:token_usage_repo_test
  - name: token_usage_repo_test
    kind: function.lua
    meta:
      name: Token Usage Repository Test
      type: test
      comment: Tests for the token usage repository functionality
      group: Usage Tests
      tags:
        - usage
        - tokens
        - database
        - tests
      description: Tests for token usage tracking
    source: file://token_usage_repo_test.lua
    modules:
      - sql
      - uuid
      - json
      - time
      - env
    imports:
      test: wippy.test:test
      token_usage_repo: wippy.usage:token_usage_repo
    method: run_tests
